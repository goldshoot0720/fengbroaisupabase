# 影片載入狀態提示功能

## 🎬 功能說明

影片庫現在支援實時顯示從 Netlify Blobs 下載和播放狀態，包含視覺化進度條，讓用戶清楚了解影片載入進度。

## ✨ 新增功能

### 1. 點擊播放時的狀態提示

當用戶點擊播放按鈕時，會顯示以下狀態：

#### 🎬 準備播放
```
圖示: 🎬
訊息: 正在從 Netlify Blobs 載入影片...
進度條: 0%
詳情: null
顏色: 藍色（info）
```

#### 📥 開始下載
```
圖示: 📥
訊息: 開始下載影片...
進度條: 0%
詳情: 正在連接 Netlify Blobs 服務器
顏色: 藍色（info）
```

#### ⏬ 下載中
```
圖示: ⏬
訊息: 下載中...
進度條: 1% - 99%（實時更新，帶動畫效果）
詳情: 已緩衝: X秒 / 總時長秒
顏色: 藍色漸變到綠色（info）
```

#### ✅ 下載完成
```
圖示: ✅
訊息: 下載完成，準備播放
進度條: 100%
詳情: 影片時長: MM:SS
顏色: 綠色（success）
持續時間: 3秒後自動消失
```

#### ⏳ 緩衝中
```
圖示: ⏳
訊息: 緩衝中，請稍候...
進度條: 無
詳情: 網路速度較慢，正在載入更多內容
顏色: 黃色（warning）
```

#### ❌ 載入失敗
```
圖示: ❌
訊息: 載入失敗 / 網路錯誤 / 解碼錯誤等
進度條: 無
詳情: 具體錯誤原因和解決建議
顏色: 紅色（error）
```

## 🎨 視覺效果

### 進度條設計

- **外觀：** 圓角矩形，帶陰影效果
- **背景：** 半透明白色
- **填充：** 藍色到綠色的漸變
- **動畫：** 
  - 寬度平滑過渡（0.3s）
  - 閃爍效果（shimmer animation）
  - 脈衝圖示動畫

### 狀態卡片樣式

- **位置：** 影片播放器上方
- **布局：** 
  - 頂部：圖示 + 訊息
  - 中間：進度條 + 百分比
  - 底部：詳細信息
- **動畫：** 滑入效果（slideIn）
- **邊框：** 左側彩色邊框（4px）
- **背景：** 漸變背景根據狀態類型

### 顏色方案

| 狀態類型 | 邊框顏色 | 背景漸變 | 進度條顏色 |
|---------|---------|---------|-----------|
| info（信息） | #3498db（藍色） | 淺藍色漸變 | 藍到綠漸變 |
| success（成功） | #27ae60（綠色） | 淺綠色漸變 | 綠色 |
| warning（警告） | #f39c12（橙色） | 淺黃色漸變 | - |
| error（錯誤） | #e74c3c（紅色） | 淺紅色漸變 | - |

## 📊 進度顯示

### 下載進度計算

```javascript
// 基於影片緩衝區計算進度
const bufferedEnd = video.buffered.end(video.buffered.length - 1)
const duration = video.duration
const progress = Math.round((bufferedEnd / duration) * 100)
```

### 進度條特效

1. **平滑過渡：** CSS transition 0.3s
2. **閃爍動畫：** 白色光澤從左到右移動
3. **漸變填充：** 藍色（#3498db）到綠色（#2ecc71）
4. **陰影效果：** 進度條帶有輕微陰影

### 詳細信息顯示

- **緩衝時間：** 已緩衝 X 秒 / 總時長 Y 秒
- **影片時長：** MM:SS 格式
- **錯誤詳情：** 具體錯誤原因和建議

## 🔧 技術實現

### 影片事件監聽

```javascript
<video
  @play="onVideoPlay"           // 用戶點擊播放
  @loadstart="onVideoLoadStart" // 開始載入
  @progress="onVideoProgress"   // 下載進度更新
  @canplay="onVideoCanPlay"     // 可以播放
  @playing="onVideoPlaying"     // 正在播放
  @waiting="onVideoWaiting"     // 緩衝中
  @error="onVideoError"         // 載入錯誤
>
```

### 狀態管理

```javascript
const videoLoadingStatus = reactive({})

// 設置狀態
videoLoadingStatus[blobKey] = {
  type: 'info',           // info | success | warning | error
  icon: '📥',             // 圖示
  message: '下載中...',    // 訊息
  progress: 50,           // 進度（0-100 或 null）
  details: '已緩衝: 10秒'  // 詳細信息（可選）
}

// 清除狀態
delete videoLoadingStatus[blobKey]
```

## 🎯 使用場景

### 場景 1: 首次播放影片（大文件）

1. 用戶點擊播放 → 顯示「正在從 Netlify Blobs 載入影片... 0%」
2. 開始下載 → 顯示「開始下載影片... 0%」
3. 下載中 → 進度條從 0% 逐漸增長到 100%
   - 顯示「下載中... 25%」
   - 顯示「已緩衝: 15秒 / 60秒」
4. 下載完成 → 顯示「下載完成，準備播放 100%」
5. 開始播放 → 3秒後狀態自動消失

### 場景 2: 網路較慢

1. 下載進度緩慢 → 進度條緩慢增長
2. 播放時緩衝 → 顯示「⏳ 緩衝中，請稍候...」
3. 繼續播放 → 狀態消失

### 場景 3: 載入失敗

1. 網路錯誤 → 顯示「❌ 網路錯誤」
   - 詳情：「無法從 Netlify Blobs 下載影片，請檢查網路連接」
2. 解碼錯誤 → 顯示「❌ 解碼錯誤」
   - 詳情：「影片文件損壞或格式不支援」

### 場景 4: 已快取影片

1. 點擊播放 → 快速載入
2. 幾乎立即顯示「✅ 下載完成 100%」
3. 3秒後自動消失
4. 開始播放

## 💡 優化建議

### 1. 預載影片

使用「預載所有影片」功能：
- 影片會快取到本地 IndexedDB
- 後續播放幾乎無需下載
- 狀態提示快速消失

### 2. 網路優化

- 使用穩定的網路連接
- 避免同時播放多個影片
- 關閉其他佔用頻寬的應用
- 影片文件較大（通常 10-50 MB），需要較長下載時間

### 3. 瀏覽器快取

- 影片會自動快取（Cache-Control: max-age=86400）
- 24小時內重複播放無需重新下載
- 清除瀏覽器快取會重新下載

## 📱 響應式設計

狀態提示在不同設備上都能正常顯示：

- **桌面端：** 完整顯示所有信息和進度條
- **平板端：** 自適應寬度，保持可讀性
- **手機端：** 堆疊顯示，進度條自適應

## 🔍 調試信息

### 控制台日誌

所有影片事件都會記錄到控制台：

```
用戶點擊播放影片: 鋒兄進化 Show🔥影片保留十五年.mp4
影片開始載入: 鋒兄進化 Show🔥影片保留十五年.mp4
影片可以播放: 鋒兄進化 Show🔥影片保留十五年.mp4
影片正在播放: 鋒兄進化 Show🔥影片保留十五年.mp4
```

### 錯誤追蹤

載入錯誤會詳細記錄：

```
影片載入錯誤 (鋒兄進化 Show🔥影片保留十五年.mp4): Event
錯誤代碼: 2 (網路錯誤)
詳情: 無法從 Netlify Blobs 下載影片，請檢查網路連接
```

## 🎨 自定義樣式

如需自定義狀態提示樣式，可修改以下 CSS 類：

```css
.loading-status          /* 基礎容器 */
.loading-status.info     /* 信息狀態 */
.loading-status.success  /* 成功狀態 */
.loading-status.warning  /* 警告狀態 */
.loading-status.error    /* 錯誤狀態 */
.status-header          /* 頂部標題區 */
.status-icon            /* 圖示 */
.status-text            /* 訊息文字 */
.progress-bar-container /* 進度條容器 */
.progress-bar           /* 進度條背景 */
.progress-fill          /* 進度條填充 */
.progress-text          /* 百分比文字 */
.status-details         /* 詳細信息 */
```

## 🚀 性能優化

### 狀態更新優化

- 使用 Vue 3 的 reactive 進行狀態管理
- 自動清理不需要的狀態
- 避免內存洩漏

### 動畫性能

- 使用 CSS transform 和 opacity
- 硬件加速動畫
- 流暢的 60fps 效果
- GPU 加速的進度條動畫

### 進度計算優化

- 實時計算緩衝進度
- 避免頻繁的 DOM 更新
- 使用 CSS transition 平滑過渡

## 📊 與音樂庫的差異

| 特性 | 音樂庫 | 影片庫 |
|-----|-------|-------|
| 文件大小 | 3-5 MB | 10-50 MB |
| 載入時間 | 較短（秒級） | 較長（分鐘級） |
| 進度條 | 簡單百分比 | 視覺化進度條 + 閃爍動畫 |
| 詳細信息 | 較少 | 更詳細（緩衝時間、影片時長） |
| 自動消失 | 2秒 | 3秒 |
| 圖示 | 音樂相關 | 影片相關 |

## 📚 相關文檔

- [音樂載入狀態功能](./MUSIC_LOADING_STATUS.md)
- [Netlify Blobs 故障排除](./NETLIFY_BLOBS_TROUBLESHOOTING.md)
- [影片庫狀態報告](./VIDEO_LIBRARY_STATUS.md)

## 🎬 示例效果

### 下載中狀態
```
┌─────────────────────────────────────────────┐
│ ⏬ 下載中...                                 │
│ ████████████░░░░░░░░░░░░░░░░░░░░░░░░  45%  │
│ 已緩衝: 27.3秒 / 60.0秒                     │
└─────────────────────────────────────────────┘
```

### 完成狀態
```
┌─────────────────────────────────────────────┐
│ ✅ 下載完成，準備播放                        │
│ ████████████████████████████████████  100%  │
│ 影片時長: 2:22                              │
└─────────────────────────────────────────────┘
```

---

**最後更新：** 2026-01-30
**版本：** 2.0.0
**新增功能：** 實時載入狀態提示 + 視覺化進度條

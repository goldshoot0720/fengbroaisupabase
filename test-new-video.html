<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°å½±ç‰‡æ¸¬è©¦ - é‹’å…„é€²åŒ– ShowğŸ”¥å½±ç‰‡ä¿ç•™åäº”å¹´</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .video-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        .video-container {
            margin: 20px 0;
            text-align: center;
        }
        video {
            width: 100%;
            max-width: 800px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .status {
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .video-details {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .detail-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        .detail-label {
            font-weight: bold;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¬ æ–°å½±ç‰‡æ¸¬è©¦</h1>
        
        <div class="video-info">
            <h3>é‹’å…„é€²åŒ– ShowğŸ”¥å½±ç‰‡ä¿ç•™åäº”å¹´</h3>
            <p>æ¸¬è©¦æ–°æ·»åŠ çš„å½±ç‰‡æ˜¯å¦å¯ä»¥æ­£å¸¸æ’­æ”¾</p>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š å½±ç‰‡ä¿¡æ¯</h3>
            <div class="video-details">
                <div class="detail-row">
                    <span class="detail-label">æª”æ¡ˆåç¨±:</span>
                    <span>é‹’å…„é€²åŒ– ShowğŸ”¥å½±ç‰‡ä¿ç•™åäº”å¹´.mp4</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">é ä¼°å¤§å°:</span>
                    <span>ç´„ 25.65 MB</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Netlify Blobs URL:</span>
                    <span>/api/blobs/é‹’å…„é€²åŒ– ShowğŸ”¥å½±ç‰‡ä¿ç•™åäº”å¹´.mp4</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">æ·»åŠ æ—¥æœŸ:</span>
                    <span>2026-01-30</span>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ”— é€£æ¥æ¸¬è©¦</h3>
            <button onclick="testBlobConnection()">æ¸¬è©¦ Netlify Blobs é€£æ¥</button>
            <div id="connection-status"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ¥ å½±ç‰‡æ’­æ”¾å™¨</h3>
            <div class="video-container">
                <video 
                    id="testVideo"
                    controls 
                    preload="metadata"
                    onloadstart="onVideoLoadStart()"
                    onloadeddata="onVideoLoaded()"
                    onerror="onVideoError(event)"
                >
                    <source src="/api/blobs/é‹’å…„é€²åŒ– ShowğŸ”¥å½±ç‰‡ä¿ç•™åäº”å¹´.mp4" type="video/mp4">
                    æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´å½±ç‰‡æ’­æ”¾ã€‚
                </video>
            </div>
            <div id="video-status"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ æ¸¬è©¦çµæœ</h3>
            <div id="test-results">
                <div class="info">ç­‰å¾…æ¸¬è©¦...</div>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ”§ æ•…éšœæ’é™¤</h3>
            <p><strong>å¦‚æœå½±ç‰‡ç„¡æ³•æ’­æ”¾ï¼Œè«‹æª¢æŸ¥ï¼š</strong></p>
            <ul>
                <li>âœ… å½±ç‰‡æª”æ¡ˆæ˜¯å¦å­˜åœ¨æ–¼ <code>public/videos/</code> ç›®éŒ„</li>
                <li>âœ… æ˜¯å¦å·²åŸ·è¡Œ <code>node scripts/upload-videos.js</code> ä¸Šå‚³åˆ° Netlify Blobs</li>
                <li>âœ… Netlify Blobs API æ˜¯å¦æ­£å¸¸é‹ä½œ</li>
                <li>âœ… ç¶²è·¯é€£æ¥æ˜¯å¦æ­£å¸¸</li>
                <li>âœ… ç€è¦½å™¨æ˜¯å¦æ”¯æ´ MP4 æ ¼å¼</li>
            </ul>
        </div>
    </div>

    <script>
        let testResults = [];

        // æ¸¬è©¦ Netlify Blobs é€£æ¥
        async function testBlobConnection() {
            const statusDiv = document.getElementById('connection-status');
            statusDiv.innerHTML = '<div class="info">ğŸ”„ æ¸¬è©¦é€£æ¥ä¸­...</div>';
            
            try {
                const response = await fetch('/api/blobs/é‹’å…„é€²åŒ– ShowğŸ”¥å½±ç‰‡ä¿ç•™åäº”å¹´.mp4', { 
                    method: 'HEAD' 
                });
                
                if (response.ok) {
                    const contentLength = response.headers.get('content-length');
                    const contentType = response.headers.get('content-type');
                    
                    statusDiv.innerHTML = `
                        <div class="success">âœ… Netlify Blobs é€£æ¥æˆåŠŸ</div>
                        <div class="video-details">
                            <div class="detail-row">
                                <span class="detail-label">HTTP ç‹€æ…‹:</span>
                                <span>${response.status} ${response.statusText}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">å…§å®¹é¡å‹:</span>
                                <span>${contentType || 'æœªçŸ¥'}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">æª”æ¡ˆå¤§å°:</span>
                                <span>${contentLength ? formatFileSize(parseInt(contentLength)) : 'æœªçŸ¥'}</span>
                            </div>
                        </div>
                    `;
                    
                    testResults.push({
                        test: 'Netlify Blobs é€£æ¥',
                        status: 'success',
                        message: 'é€£æ¥æˆåŠŸ'
                    });
                } else {
                    statusDiv.innerHTML = `<div class="error">âŒ é€£æ¥å¤±æ•—: HTTP ${response.status}</div>`;
                    testResults.push({
                        test: 'Netlify Blobs é€£æ¥',
                        status: 'error',
                        message: `HTTP ${response.status}`
                    });
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="error">âŒ é€£æ¥éŒ¯èª¤: ${error.message}</div>`;
                testResults.push({
                    test: 'Netlify Blobs é€£æ¥',
                    status: 'error',
                    message: error.message
                });
            }
            
            updateTestResults();
        }

        // å½±ç‰‡è¼‰å…¥é–‹å§‹
        function onVideoLoadStart() {
            const statusDiv = document.getElementById('video-status');
            statusDiv.innerHTML = '<div class="info">ğŸ”„ å½±ç‰‡è¼‰å…¥ä¸­...</div>';
        }

        // å½±ç‰‡è¼‰å…¥å®Œæˆ
        function onVideoLoaded() {
            const statusDiv = document.getElementById('video-status');
            const video = document.getElementById('testVideo');
            
            statusDiv.innerHTML = `
                <div class="success">âœ… å½±ç‰‡è¼‰å…¥æˆåŠŸ</div>
                <div class="video-details">
                    <div class="detail-row">
                        <span class="detail-label">å½±ç‰‡é•·åº¦:</span>
                        <span>${formatDuration(video.duration)}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">å½±ç‰‡å°ºå¯¸:</span>
                        <span>${video.videoWidth} x ${video.videoHeight}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">æº–å‚™ç‹€æ…‹:</span>
                        <span>${getReadyState(video.readyState)}</span>
                    </div>
                </div>
            `;
            
            testResults.push({
                test: 'å½±ç‰‡è¼‰å…¥',
                status: 'success',
                message: 'è¼‰å…¥æˆåŠŸ'
            });
            
            updateTestResults();
        }

        // å½±ç‰‡è¼‰å…¥éŒ¯èª¤
        function onVideoError(event) {
            const statusDiv = document.getElementById('video-status');
            const video = event.target;
            const error = video.error;
            
            let errorMessage = 'æœªçŸ¥éŒ¯èª¤';
            if (error) {
                switch (error.code) {
                    case 1:
                        errorMessage = 'MEDIA_ERR_ABORTED - å½±ç‰‡è¼‰å…¥è¢«ä¸­æ­¢';
                        break;
                    case 2:
                        errorMessage = 'MEDIA_ERR_NETWORK - ç¶²è·¯éŒ¯èª¤';
                        break;
                    case 3:
                        errorMessage = 'MEDIA_ERR_DECODE - è§£ç¢¼éŒ¯èª¤';
                        break;
                    case 4:
                        errorMessage = 'MEDIA_ERR_SRC_NOT_SUPPORTED - ä¸æ”¯æ´çš„æ ¼å¼';
                        break;
                }
            }
            
            statusDiv.innerHTML = `
                <div class="error">âŒ å½±ç‰‡è¼‰å…¥å¤±æ•—</div>
                <div class="video-details">
                    <div class="detail-row">
                        <span class="detail-label">éŒ¯èª¤ä»£ç¢¼:</span>
                        <span>${error ? error.code : 'æœªçŸ¥'}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">éŒ¯èª¤è¨Šæ¯:</span>
                        <span>${errorMessage}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">ç¶²è·¯ç‹€æ…‹:</span>
                        <span>${getNetworkState(video.networkState)}</span>
                    </div>
                </div>
            `;
            
            testResults.push({
                test: 'å½±ç‰‡è¼‰å…¥',
                status: 'error',
                message: errorMessage
            });
            
            updateTestResults();
        }

        // æ›´æ–°æ¸¬è©¦çµæœ
        function updateTestResults() {
            const resultsDiv = document.getElementById('test-results');
            
            if (testResults.length === 0) {
                resultsDiv.innerHTML = '<div class="info">ç­‰å¾…æ¸¬è©¦...</div>';
                return;
            }
            
            let html = '';
            testResults.forEach(result => {
                const statusClass = result.status === 'success' ? 'success' : 'error';
                const statusIcon = result.status === 'success' ? 'âœ…' : 'âŒ';
                html += `<div class="${statusClass}">${statusIcon} ${result.test}: ${result.message}</div>`;
            });
            
            resultsDiv.innerHTML = html;
        }

        // æ ¼å¼åŒ–æª”æ¡ˆå¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // æ ¼å¼åŒ–æ™‚é–“é•·åº¦
        function formatDuration(seconds) {
            if (isNaN(seconds)) return 'æœªçŸ¥';
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        // ç²å–æº–å‚™ç‹€æ…‹
        function getReadyState(state) {
            const states = {
                0: 'HAVE_NOTHING - æ²’æœ‰è³‡æ–™',
                1: 'HAVE_METADATA - æœ‰å…ƒè³‡æ–™',
                2: 'HAVE_CURRENT_DATA - æœ‰ç•¶å‰è³‡æ–™',
                3: 'HAVE_FUTURE_DATA - æœ‰æœªä¾†è³‡æ–™',
                4: 'HAVE_ENOUGH_DATA - æœ‰è¶³å¤ è³‡æ–™'
            };
            return states[state] || 'æœªçŸ¥ç‹€æ…‹';
        }

        // ç²å–ç¶²è·¯ç‹€æ…‹
        function getNetworkState(state) {
            const states = {
                0: 'NETWORK_EMPTY - ç©ºé–’',
                1: 'NETWORK_IDLE - é–’ç½®',
                2: 'NETWORK_LOADING - è¼‰å…¥ä¸­',
                3: 'NETWORK_NO_SOURCE - ç„¡ä¾†æº'
            };
            return states[state] || 'æœªçŸ¥ç‹€æ…‹';
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æ¸¬è©¦é€£æ¥
        window.onload = function() {
            setTimeout(() => {
                testBlobConnection();
            }, 1000);
        };
    </script>
</body>
</html>
# 音樂載入狀態提示功能

## 🎵 功能說明

音樂庫現在支援實時顯示下載和播放狀態，讓用戶清楚了解音樂載入進度。

## ✨ 新增功能

### 1. 點擊播放時的狀態提示

當用戶點擊播放按鈕時，會顯示以下狀態：

#### 🔄 準備播放
```
圖示: 🔄
訊息: 準備播放...
顏色: 藍色（info）
```

#### 📥 開始下載
```
圖示: 📥
訊息: 開始下載音樂...
進度: 0%
顏色: 藍色（info）
```

#### ⏬ 下載中
```
圖示: ⏬
訊息: 下載中...
進度: 1% - 99%（實時更新）
顏色: 藍色（info）
```

#### ✅ 下載完成
```
圖示: ✅
訊息: 下載完成，準備播放
進度: 100%
顏色: 綠色（success）
持續時間: 2秒後自動消失
```

#### ⏳ 緩衝中
```
圖示: ⏳
訊息: 緩衝中...
顏色: 黃色（warning）
```

#### ❌ 載入失敗
```
圖示: ❌
訊息: 載入失敗 / 網路錯誤 / 解碼錯誤等
顏色: 紅色（error）
```

## 🎨 視覺效果

### 狀態提示樣式

- **位置：** 音頻播放器上方
- **動畫：** 滑入效果（slideIn）
- **圖示動畫：** 脈衝效果（pulse）
- **漸變背景：** 根據狀態類型顯示不同顏色
- **自動消失：** 成功狀態 2 秒後自動隱藏

### 顏色方案

| 狀態類型 | 背景顏色 | 文字顏色 | 邊框顏色 |
|---------|---------|---------|---------|
| info（信息） | 淺藍色漸變 | 深藍色 | 藍色 |
| success（成功） | 淺綠色漸變 | 深綠色 | 綠色 |
| warning（警告） | 淺黃色漸變 | 深黃色 | 黃色 |
| error（錯誤） | 淺紅色漸變 | 深紅色 | 紅色 |

## 📊 進度顯示

### 下載進度計算

```javascript
// 基於音頻緩衝區計算進度
const bufferedEnd = audio.buffered.end(audio.buffered.length - 1)
const duration = audio.duration
const progress = Math.round((bufferedEnd / duration) * 100)
```

### 進度顯示格式

- **範圍：** 0% - 100%
- **更新頻率：** 實時更新
- **顯示位置：** 狀態提示右側
- **字體：** 粗體，較大字號

## 🔧 技術實現

### 音頻事件監聽

```javascript
<audio
  @play="onAudioPlay"           // 用戶點擊播放
  @loadstart="onAudioLoadStart" // 開始載入
  @progress="onAudioProgress"   // 下載進度更新
  @canplay="onAudioCanPlay"     // 可以播放
  @playing="onAudioPlaying"     // 正在播放
  @waiting="onAudioWaiting"     // 緩衝中
  @error="onAudioError"         // 載入錯誤
>
```

### 狀態管理

```javascript
const audioLoadingStatus = reactive({})

// 設置狀態
audioLoadingStatus[blobKey] = {
  type: 'info',      // info | success | warning | error
  icon: '📥',        // 圖示
  message: '下載中...', // 訊息
  progress: 50       // 進度（可選）
}

// 清除狀態
delete audioLoadingStatus[blobKey]
```

## 🎯 使用場景

### 場景 1: 首次播放音樂

1. 用戶點擊播放 → 顯示「準備播放...」
2. 開始下載 → 顯示「開始下載音樂... 0%」
3. 下載中 → 顯示「下載中... 25%」→ 「50%」→ 「75%」
4. 下載完成 → 顯示「下載完成，準備播放 100%」
5. 開始播放 → 狀態自動消失

### 場景 2: 網路較慢

1. 下載進度緩慢 → 持續顯示「下載中... X%」
2. 播放時緩衝 → 顯示「緩衝中...」
3. 繼續播放 → 狀態消失

### 場景 3: 載入失敗

1. 網路錯誤 → 顯示「❌ 網路錯誤」
2. 解碼錯誤 → 顯示「❌ 解碼錯誤」
3. 不支援格式 → 顯示「❌ 不支援的格式」

### 場景 4: 已快取音樂

1. 點擊播放 → 快速載入
2. 幾乎立即顯示「✅ 下載完成」
3. 2秒後自動消失
4. 開始播放

## 💡 優化建議

### 1. 預載音樂

使用「預載所有音樂」功能：
- 音樂會快取到本地 IndexedDB
- 後續播放幾乎無需下載
- 狀態提示快速消失

### 2. 網路優化

- 使用穩定的網路連接
- 避免同時播放多首音樂
- 關閉其他佔用頻寬的應用

### 3. 瀏覽器快取

- 音樂會自動快取（Cache-Control: max-age=86400）
- 24小時內重複播放無需重新下載
- 清除瀏覽器快取會重新下載

## 📱 響應式設計

狀態提示在不同設備上都能正常顯示：

- **桌面端：** 完整顯示所有信息
- **平板端：** 自適應寬度
- **手機端：** 堆疊顯示，保持可讀性

## 🔍 調試信息

### 控制台日誌

所有音頻事件都會記錄到控制台：

```
用戶點擊播放: 鋒兄的傳奇人生/鋒兄的傳奇人生.mp3
音樂開始載入: 鋒兄的傳奇人生/鋒兄的傳奇人生.mp3
音樂可以播放: 鋒兄的傳奇人生/鋒兄的傳奇人生.mp3
音樂正在播放: 鋒兄的傳奇人生/鋒兄的傳奇人生.mp3
```

### 錯誤追蹤

載入錯誤會詳細記錄：

```
音樂載入錯誤 (鋒兄的傳奇人生/鋒兄的傳奇人生.mp3): Event
錯誤代碼: 2 (網路錯誤)
```

## 🎨 自定義樣式

如需自定義狀態提示樣式，可修改以下 CSS 類：

```css
.loading-status        /* 基礎容器 */
.loading-status.info   /* 信息狀態 */
.loading-status.success /* 成功狀態 */
.loading-status.warning /* 警告狀態 */
.loading-status.error  /* 錯誤狀態 */
.status-icon          /* 圖示 */
.status-text          /* 訊息文字 */
.status-progress      /* 進度百分比 */
```

## 🚀 性能優化

### 狀態更新優化

- 使用 Vue 3 的 reactive 進行狀態管理
- 自動清理不需要的狀態
- 避免內存洩漏

### 動畫性能

- 使用 CSS transform 和 opacity
- 硬件加速動畫
- 流暢的 60fps 效果

## 📚 相關文檔

- [音樂庫實現指南](./MUSIC_LIBRARY_IMPLEMENTATION.md)
- [Netlify Blobs 故障排除](./NETLIFY_BLOBS_TROUBLESHOOTING.md)
- [音樂庫快速開始](./MUSIC_QUICK_START.md)

---

**最後更新：** 2026-01-30
**版本：** 2.0.0
**新增功能：** 實時載入狀態提示
